"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.loadEnvVariables = exports.dotenv = void 0;
const fs_1 = __importDefault(require("fs"));
const lodash_1 = __importDefault(require("lodash"));
const path_1 = __importDefault(require("path"));
const yargs_1 = __importDefault(require("yargs"));
const dotenv_1 = __importDefault(require("dotenv"));
exports.dotenv = dotenv_1.default;
function readFile(target) {
    try {
        return fs_1.default.readFileSync(target);
    }
    catch (error) {
        return '';
    }
}
function loadEnvVariables(from = process.cwd()) {
    const mode = yargs_1.default.argv.mode;
    const baseEnv = dotenv_1.default.parse(readFile(path_1.default.join(from, '.env')));
    const localEnv = dotenv_1.default.parse(readFile(path_1.default.join(from, '.env.local')));
    const modeEnv = dotenv_1.default.parse(readFile(path_1.default.join(from, `.env.${mode}`)));
    const unionConfig = lodash_1.default.merge({}, baseEnv, localEnv, modeEnv);
    return Object.keys(unionConfig).reduce((prev, key) => {
        return lodash_1.default.set(prev, key, unionConfig[key]);
    }, {});
}
exports.loadEnvVariables = loadEnvVariables;
